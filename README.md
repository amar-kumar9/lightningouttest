# Salesforce Lightning Out Host Application

A production-ready Node.js Express application that hosts Salesforce Lightning Web Components using the Lightning Out framework. This application provides OAuth 2.0 authentication and securely renders Lightning components outside of the Salesforce platform.

## ğŸš€ Quick Start

### Verify App Works First
```bash
# Test that everything is set up correctly
npm test
```

If tests pass, you're ready to deploy!

### Local Development

1. **Install Dependencies**
   ```bash
   npm install
   ```

2. **Setup Configuration**
   ```bash
   node setup.js
   ```

3. **Run Locally**
   ```bash
   # Development mode (with status page)
   npm run dev

   # Production mode
   npm start
   ```

   Visit: `http://localhost:5000`

### Deploy to Render (Recommended)

**ğŸ“š See [QUICK_START.md](./QUICK_START.md) for 5-minute deployment guide!**

**ğŸ“š See [WORKFLOW.md](./WORKFLOW.md) for development workflow (making changes â†’ git â†’ deploy)**

---

## ğŸ“¦ Deployment

This application is ready to deploy to any hosting platform with HTTPS support. **HTTPS is required** for Salesforce Lightning Out to work.

### ğŸ† Recommended Hosting Platforms

1. **[Render](https://render.com)** â­ **BEST FOR QUICK TESTING**
   - Free tier with HTTPS
   - 5-minute setup
   - See `HOSTING_GUIDE.md` for detailed instructions

2. **[Railway](https://railway.app)** â­ **BEST FOR PRODUCTION**
   - Free tier with $5 credit/month
   - Always-on, no sleep delays
   - Fast deployments

3. **[Fly.io](https://fly.io)** â­ **BEST FOR SCALE**
   - Free tier with 3 VMs
   - Global edge network
   - Production-ready

**ğŸ“š See [HOSTING_GUIDE.md](./HOSTING_GUIDE.md) for complete deployment instructions for all platforms.**

---

## ğŸ”§ Salesforce Setup

### 1. Create Connected App

1. Go to **Setup â†’ App Manager â†’ New Connected App**
2. Fill in basic information:
   - **Connected App Name**: Lightning Out Host
   - **API Name**: LightningOutHost
   - **Contact Email**: your-email@example.com
3. Enable **OAuth Settings**:
   - **Callback URL**: `https://your-app-url.com/oauth/callback`
   - **Selected OAuth Scopes**:
     - Full access (full)
     - Perform requests at any time (refresh_token, offline_access)
4. Save and note:
   - **Consumer Key** (this is your `SF_CLIENT_ID`)
   - **Consumer Secret** (this is your `SF_CLIENT_SECRET`)

### 2. Create Lightning Out App Dependency

In Salesforce, create an Aura component for Lightning Out:

1. Go to **Developer Console** or **VS Code with Salesforce Extensions**
2. Create new Aura Application: `lightningOutApp.app`
3. Add this content:

```xml
<aura:application access="GLOBAL" extends="ltng:outApp">
    <aura:dependency resource="c:caseList"/>
    <aura:dependency resource="c:caseDetail"/>
    <aura:dependency resource="c:caseComments"/>
</aura:application>
```

4. Deploy to your org

### 3. Create Lightning Web Components

Ensure these components exist in your Salesforce org:
- `c:caseList` - Case list component
- `c:caseDetail` - Case detail component  
- `c:caseComments` - Case comments component

---

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ index.js              # Main Express application
â”œâ”€â”€ dev-server.js         # Development server with status page
â”œâ”€â”€ setup.js              # Setup script to generate .env
â”œâ”€â”€ package.json          # Dependencies and scripts
â”œâ”€â”€ render.yaml           # Render.com deployment config
â”œâ”€â”€ railway.json          # Railway.app deployment config
â”œâ”€â”€ fly.toml              # Fly.io deployment config
â”œâ”€â”€ Dockerfile            # Docker configuration
â”œâ”€â”€ HOSTING_GUIDE.md      # Detailed hosting instructions
â””â”€â”€ README.md             # This file
```

---

## ğŸ” Security Features

- âœ… **PKCE (Proof Key for Code Exchange)** - Enhanced OAuth 2.0 security
- âœ… **CSRF Protection** - OAuth state parameter validation
- âœ… **Secure Sessions** - Server-side session storage with httpOnly cookies
- âœ… **HTTPS Enforcement** - Required for production
- âœ… **Secure Cookies** - Automatically enabled in production
- âœ… **Token Security** - Access tokens stored server-side only

---

## ğŸŒ Environment Variables

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `SF_CLIENT_ID` | âœ… Yes | Salesforce Connected App Client ID | `3MVG9...` |
| `SF_CLIENT_SECRET` | âœ… Yes | Salesforce Connected App Client Secret | `ABC123...` |
| `APP_URL` | âœ… Yes | Your HTTPS application URL | `https://your-app.onrender.com` |
| `SESSION_SECRET` | âœ… Yes | Secret for session encryption | Auto-generated by setup.js |
| `NODE_ENV` | âš ï¸ Recommended | Environment mode | `production` |
| `PORT` | âš ï¸ Optional | Server port | `5000` (default) |
| `SF_LOGIN_URL` | âš ï¸ Optional | Salesforce login URL | `https://login.salesforce.com` |

---

## ğŸ› ï¸ Available Scripts

```bash
# Run development server (with status page)
npm run dev

# Run production server
npm start

# Setup configuration (generates .env)
node setup.js
```

---

## ğŸ“¡ API Endpoints

- `GET /` - Home page with login button
- `GET /login` - Initiates Salesforce OAuth flow
- `GET /oauth/callback` - OAuth callback handler
- `GET /app` - Main application (requires authentication)
- `GET /logout` - Logout and clear session
- `GET /health` - Health check endpoint

---

## ğŸ§ª Testing

1. **Local Testing:**
   ```bash
   npm run dev
   # Visit http://localhost:5000
   ```

2. **Health Check:**
   ```bash
   curl http://localhost:5000/health
   ```

3. **Production Testing:**
   - Deploy to Render/Railway/Fly.io
   - Visit your HTTPS URL
   - Complete OAuth flow
   - Verify Lightning components load

---

## ğŸ› Troubleshooting

### OAuth Callback Fails
- âœ… Verify `APP_URL` matches your actual URL exactly (including `https://`)
- âœ… Check Salesforce Connected App callback URL matches
- âœ… Ensure HTTPS is enabled (required for Lightning Out)

### Components Don't Load
- âœ… Verify Lightning Out app dependency exists in Salesforce
- âœ… Check browser console for errors
- âœ… Ensure components are deployed to your Salesforce org

### Session Issues
- âœ… Ensure `SESSION_SECRET` is set
- âœ… Check `NODE_ENV=production` for secure cookies
- âœ… Verify cookies are enabled in browser

---

## ğŸ“š Additional Resources

- [Salesforce Lightning Out Documentation](https://developer.salesforce.com/docs/atlas.en-us.lightning.meta/lightning/lightning_out_intro.htm)
- [OAuth 2.0 PKCE Flow](https://oauth.net/2/pkce/)
- [Render Documentation](https://render.com/docs)
- [Railway Documentation](https://docs.railway.app)

---

## ğŸ“ License

This project is provided as-is for hosting Salesforce Lightning Out applications.

---

## ğŸ†˜ Support

For deployment help, see [HOSTING_GUIDE.md](./HOSTING_GUIDE.md)

For Salesforce setup, refer to the Salesforce Setup section above or [replit.md](./replit.md)

---

**Ready to deploy?** Check out [HOSTING_GUIDE.md](./HOSTING_GUIDE.md) for step-by-step instructions! ğŸš€

